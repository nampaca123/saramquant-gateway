SaramQuant 콘셉트와 UIUX 설계



## 1. 시장 분석

### 1.1 기존 서비스 분류

한국 시장의 개인 투자 관련 서비스는 크게 세 카테고리로 나뉜다.

**카테고리 A: 퀀트 전략/백테스트 플랫폼**

- 대표: 퀀터스, 인텔리퀀트, 마이퀀트, 트레이딩뱅크
- 특징: 사용자가 직접 투자 전략을 설계하고, 백테스트로 검증하고, 자동매매까지 연결
- 퀀터스는 100개 이상의 투자 팩터로 백테스트를 지원하며 누적 가입자 6.8만 명, 248만 회 이상의 백테스트 수행
- 한계: **이미 퀀트를 아는 사람을 위한 도구**. "RSI 14일 기준 30 이하일 때 매수" 같은 조건을 직접 설계할 줄 아는 중급 이상 투자자가 타겟. 초보자가 열면 뭘 해야 할지 모름

**카테고리 B: 로보어드바이저**

- 대표: 올리(Olly), 핀트(fint), 키움 로보마켓
- 특징: 돈을 넣으면 AI가 포트폴리오를 구성하고 자동으로 매매
- 올리는 AI 기반 개인화 포트폴리오와 매매 자동화를 통해 "쉽고 안전한" 투자를 표방
- 한계: 사용자가 **왜 이 종목을 사는지, 지금 내 리스크가 어떤지 전혀 모른 채** 투자. 판단을 완전히 위임하는 블랙박스 구조. 투자 역량이 성장하지 않음

**카테고리 C: 증권 앱 내장 스크리너**

- 대표: 토스증권, [Investing.com](http://Investing.com), 키움 영웅문
- 특징: 주식 매매 앱 안에 종목 검색/필터 기능 탑재
- 토스증권은 증권 앱 UX 스코어 1위(73.2점)를 기록할 만큼 UI가 깔끔
- 한계: 스크리너가 재무 지표(시총, PER, 배당률) 중심. **퀀트 기술 지표(RSI, 볼린저밴드, 베타, 샤프비율) 기반 리스크 분석은 부재**. Investing.com은 기술 지표가 있으나 UI가 구시대적이고 정보 과부하

### 1.2 시장의 공백

| 기존 서비스       | 접근 방식                 | 빈 자리                 |
| ----------------- | ------------------------- | ----------------------- |
| 퀀터스/인텔리퀀트 | "네가 직접 전략을 짜"     | 너무 어렵다             |
| 올리/핀트         | "네가 아무것도 몰라도 돼" | 배우는 게 없다          |
| 토스증권          | "쉽고 예쁘게"             | 퀀트 리스크 분석이 없다 |

**세 카테고리 사이에 아무도 차지하지 않은 포지션이 있다:** "사용자가 직접 판단하되, 어려운 부분은 번역해주는 도구"

### 1.3 기존 서비스가 못 하는 세 가지

1. **숫자 → 신호 번역**: RSI 68이라는 숫자를 보여주는 앱은 있다. "그래서 이게 왜 위험한데?"를 쉬운 말로 설명해주는 서비스는 없다.
2. **내 포트폴리오의 퀀트 리스크 진단**: 로보어드바이저는 자기들이 만든 포트폴리오만 관리한다. 사용자가 이미 보유한 종목 조합의 전체 베타, 분산 효과, 샤프비율을 진단해주는 무료 서비스가 없다.
3. **몬테카를로 시뮬레이션의 초보자용 시각화**: "이 포트폴리오로 1년 가면 95% 확률로 이 범위 안에 있어요"라는 확률적 미래 시각화를 일반인 눈높이로 제공하는 한국 서비스가 없다.

------

## 2. 제품 정의

### 2.1 한 줄 정의

**리스크를 숫자가 아닌 신호로 번역해주는 퀀트 내비게이터**

### 2.2 미션

금융 지식이나 비싼 도구 없이도, 누구나 자신의 투자 리스크를 숫자로 확인하고 행동할 수 있게 만든다.

### 2.3 포지셔닝

- 직접 전략을 짜는 퀀트 플랫폼(퀀터스)이 아니다
- 판단을 위임하는 로보어드바이저(올리)가 아니다
- 매매를 실행하는 증권 앱(토스증권)이 아니다
- **사용자의 "판단력"을 키워주는 리스크 해석 도구**다

### 2.4 이 앱이 하지 않는 것

- 매수/매도 추천
- 실제 매매 실행
- 계좌 연동
- 실시간 호가/체결
- 뉴스 피드

------

## 3. 핵심 타겟

### 3.1 타겟 페르소나: "지현" (25세, 사회 초년생)

| 항목      | 내용                                                         |
| --------- | ------------------------------------------------------------ |
| 나이      | 25세, 입사 1년차                                             |
| 투자 경험 | 토스증권으로 삼성전자, 테슬라 소액 매수 경험 있음            |
| 투자 지식 | PER이 뭔지는 알지만, RSI/볼린저밴드는 이름만 들어봄          |
| 현재 문제 | 유튜브/커뮤니티에서 종목 추천은 받지만, "이거 지금 들어가도 괜찮은 건지" 판단 기준이 없음 |
| 두려움    | "또 물리면 어쩌지", "내가 감당할 수 있는 위험인지 모르겠어"  |
| 원하는 것 | "매수 타이밍"이 아니라 "내가 감당할 수 있는 위험인지" 확인하는 것 |
| 앱 취향   | 토스, 당근처럼 깔끔한 앱에 익숙. 복잡하면 3초 안에 이탈      |

### 3.2 왜 20대 중반 사회 초년생인가

- 첫 투자를 시작하는 시기 → 올바른 습관 형성의 골든타임
- 입소문(바이럴) 확산 속도가 가장 빠른 연령대
- 블룸버그 터미널(월 $2,000)이나 유료 퀀트 툴에 접근 불가 → 금융 포용성 메시지와 정확히 맞음
- 이 연령대가 정착하면 30대까지 자연스럽게 리텐션

------

## 4. 우리가 해결하는 문제 ✦ UPDATED

| 사용자의 현재 상황                      | SaramQuant가 주는 것                                         |
| --------------------------------------- | ------------------------------------------------------------ |
| RSI, 볼린저밴드 같은 용어를 모름        | 5차원 성적표 + 요약 배지(🟢/🟡/🔴)로 상태를 한눈에 보여줌         |
| "지금 과열인지 저점인지" 감으로 판단    | 정량 지표 기반 리스크 등급 제공                              |
| PER 15배가 비싼 건지 싼 건지 모름 ✦     | 업종 평균과 비교해서 "이 회사는 같은 업종 대비 비싼 편이에요"로 번역 ✦ |
| 부채비율, ROE 숫자만 보고 의미를 모름 ✦ | "이 회사는 빚이 자본의 2배예요. 같은 업종 평균보다 높은 편이에요"로 해석 ✦ |
| 포트폴리오 전체 리스크를 모름           | 종목 조합의 전체 베타·변동성·분산 효과를 계산                |
| "1년 뒤에 얼마가 될까?"가 막연함        | 몬테카를로 시뮬레이션으로 확률적 미래 범위를 시각화          |
| 지표 해석이 어려움                      | LLM이 쉬운 말로 해석해줌                                     |
| 퀀트 도구는 비싸거나 어려움             | 무료로, 토스 수준의 쉬운 UI로 제공                           |

------

## 5. 핵심 개념: Risk Badge 시스템

앱 전체를 관통하는 통일된 언어. 모든 화면에서 이 배지가 등장한다.

### 5.1 5차원 리스크 성적표

Risk Badge는 하나의 종목을 **5개 차원**으로 나누어 평가하는 "성적표"다. 사용자에게는 "이 종목의 현재 상태를 5가지 관점에서 본 결과"로 전달한다.

| 차원 | 사용자에게 보이는 질문 | 핵심 지표 |
|------|----------------------|----------|
| 가격 과열도 | "지금 과열이야?" | RSI, 볼린저밴드 |
| 변동성 | "많이 출렁여?" | 베타, 팩터 변동성 z-score |
| 추세 강도 | "방향이 강해?" | ADX, +DI, -DI |
| 회사 체력 | "이 회사 괜찮아?" | 부채비율, ROE, 영업이익률 (업종 대비) |
| 밸류에이션 | "지금 가격이 비싸?" | PER, PBR (업종 대비) |

각 차원은 3등급으로 표현:

- **🟢 Stable (안정)** — 특별한 이상 신호 없음
- **🟡 Caution (주의)** — 일부 지표에서 주의 신호 감지
- **🔴 Warning (경고)** — 복수 지표에서 경고 신호. 신중한 판단 필요

> "Warning"은 "위험하다"가 아니라 "불확실성이 높으니 신중히 평가하라"는 의미. Morningstar의 Uncertainty Rating 프레임워크를 참고하여, 공포를 조장하지 않되 신중함을 유도하는 표현을 채택했다.

### 5.2 요약 배지

5개 차원을 종합한 하나의 대표 뱃지. 사용자가 리스트에서 종목을 훑을 때 이것만 보면 된다.

**산출 원칙:**
- **회사 체력·밸류에이션**(구조적 위험)에서 경고가 나오면 → 요약도 경고
- **가격 과열·변동성·추세**(시장 신호)에서 경고가 하나만 나오면 → 다른 차원이 괜찮으면 주의로 완화
- 시장 신호 경고가 2개 이상 겹치면 → 복합 위험으로 경고

> 사용자에게는 요약 뱃지 아래에 "왜 이 등급인지"를 차원별 카드로 펼쳐 보여준다.

### 5.3 업종 상대 비교

펀더멘털 평가(회사 체력, 밸류에이션)는 **절대 기준이 아닌 동일 업종 대비 상대 비교**로 산출한다. "PER 15가 비싼가?"라는 질문에 "같은 업종 평균이 20이니 오히려 저렴한 편"으로 답해주는 방식.

- 사용자에게 보이는 문장 예: "이 회사의 PER은 12.3으로, 같은 업종 평균(18배)보다 낮은 편이에요"
- 업종 내 종목 수가 적으면 시장 전체 평균으로 자동 전환

### 5.4 포트폴리오 레벨 배지

- 포트폴리오 전체 베타, 가중평균 변동성, 상관관계 기반 분산 효과를 종합하여 별도 산출
- 개별 종목이 전부 🟢이어도 상관관계가 높으면 포트폴리오는 🟡이 될 수 있음

### 5.5 배지 디자인 원칙

- 색상만으로 판단하지 않도록 아이콘 + 텍스트 병행 (색각 이상 대응)
- 배지는 "매수/매도 추천"이 절대 아님을 UI에서 명시
- 하단에 항상 고정: "이 배지는 투자 조언이 아닌 리스크 참고 지표입니다"
- 한국어·영어 2개 언어 지원 (프론트엔드 i18n)

------

## 6. User Journey

### 6.1 첫 방문 (온보딩)

**목표:** "이 앱이 뭘 해주는지" 10초 안에 이해

1. 스플래시 → "당신의 투자, 리스크부터 확인하세요"
2. 3장짜리 온보딩 카드
   - "종목의 위험 신호를 색으로 보여드려요" (배지 예시)
   - "어려운 지표? AI가 쉽게 설명해드려요" (LLM 해석 예시)
   - "내 포트폴리오 전체 리스크도 한눈에" (포트폴리오 진단 예시)
3. 관심 시장 선택 (한국주식 / 미국주식 / 둘 다)
4. 홈 화면 진입

### 6.2 일상 사용 루프 (Daily Loop)

매일 1~2분 안에 완료되는 핵심 경험.

```
앱 열기
  → Home에서 시장 리스크 요약 확인 (10초)
  → 내 포트폴리오 배지 변화 확인 (10초)
  → 배지가 바뀐 종목 탭 → Detail에서 이유 확인 (30초)
  → 필요하면 AI에게 "이거 왜 빨간색이야?" 질문 (30초)
  → 닫기
```

### 6.3 탐색 사용 루프 (Explore Loop)

새 종목을 찾거나 포트폴리오를 재구성할 때.

```
Screener에서 조건 설정
  → "베타 낮고 샤프 양수인 종목" 필터
  → 결과 리스트에서 종목 탭
  → Detail에서 리스크 상세 확인
  → AI에게 "이 종목 초보자한테 괜찮아?" 질문
  → 포트폴리오에 추가하고 전체 리스크 변화 확인
  → 몬테카를로 시뮬레이션으로 1년 뒤 예상 범위 확인
```

### 6.4 진단 사용 루프 (Diagnosis Loop)

기존 보유 종목의 리스크를 점검할 때.

```
Portfolio Check에서 보유 종목 + 비중 입력
  → 전체 포트폴리오 Risk Badge 확인
  → 분산 효과 시각화 확인 ("상관관계 때문에 분산이 안 되고 있네")
  → 몬테카를로 시뮬레이션 확인 ("1년 뒤 95% 확률 범위")
  → AI에게 "리스크 줄이려면 어떻게 바꿔?" 질문
  → 비중 조정 후 재계산
```

------

## 7. 화면 설계

### 7.1 정보 구조 (사이트맵)

```
SaramQuant
├── Onboarding (첫 방문 시에만)
│   ├── 소개 카드 3장
│   └── 관심 시장 선택
│
├── Home (Market Pulse)
│   ├── 시장 지수 리스크 카드 (4개)
│   ├── 내 포트폴리오 리스크 변화
│   └── 리스크 급변 종목 Top 10
│
├── Screener (Risk Screener)
│   ├── 필터 패널 (기본 + 고급)
│   └── 결과 리스트
│
├── Stock Detail (종목 리포트)
│   ├── 리스크 요약 카드
│   ├── 가격 차트
│   ├── AI 해석
│   ├── 벤치마크 비교
│   └── 포트폴리오 추가 CTA
│
├── Portfolio Check (포트폴리오 진단)
│   ├── 전체 리스크 배지
│   ├── 핵심 지표 카드
│   ├── 종목 구성 + 비중 조정
│   ├── 분산 효과 시각화
│   ├── 몬테카를로 시뮬레이션
│   └── AI 진단
│
└── Settings
    ├── 관심 시장 변경
    ├── 저장된 포트폴리오 관리
    └── AI 사용량 확인
```

### 7.2 Home — Market Pulse

**목적:** 앱을 열었을 때 30초 안에 "오늘 시장이 어떤 상태인지" 파악

**상단: 시장 리스크 요약 카드**

- 코스피 / 코스닥 / S&P500 / 나스닥
- 각 지수의 현재가, 등락률, Risk Badge
- 카드 형태로 가로 스크롤

**중단: 리스크 알림 섹션 — "오늘의 리스크 변화"**

- 내 포트폴리오 종목 중 배지가 변한 것만 표시
- 포트폴리오가 없으면 "포트폴리오를 등록하면 여기서 변화를 추적해요" CTA로 대체
- 예시: "삼성전자 Stable→Caution: 가격 과열도에서 주의 신호가 감지됐어요"

**하단: 리스크 급변 종목 Top 10**

- 수익률 랭킹이 아님. 리스크 배지가 바뀌었거나 변동성이 급증한 종목
- "Warning 전환" / "Stable 전환" 탭 분리
- 각 종목: 이름, 현재가, 등락률, Risk Badge, 변동 사유 한 줄

**이 화면에 의도적으로 없는 것:**

- 뉴스 피드 (노이즈)
- 수익률 랭킹 (FOMO 유발, 금융 포용성에 반함)
- 실시간 호가 (매매 앱이 아님)

### 7.3 Screener — Risk Screener ✦ UPDATED

**목적:** 조건에 맞는 종목을 리스크 관점에서 찾기

**필터 영역 (상단, 접었다 펼 수 있는 구조)**

기본 필터 (항상 노출):

- 시장: 코스피 / 코스닥 / NYSE / 나스닥
- Risk Badge: Stable / Caution / Warning (다중 선택)

고급 필터 (펼치면 노출):

- 베타 범위 (슬라이더, 0.0 ~ 2.0)
- 샤프 비율 (슬라이더, -1.0 ~ 3.0)
- RSI 구간 (과매도 / 중립 / 과열)
- 변동성 수준 (ATR 기반, 낮음/보통/높음)
- 추세 강도 (ADX 기반, 약/보통/강)
- PER 범위 (슬라이더, 0 ~ 100)
- PBR 범위 (슬라이더, 0.0 ~ 10.0)
- ROE 범위 (슬라이더, -50% ~ 100%)
- 부채비율 상한 (슬라이더, 0% ~ 500%)

**각 필터 옆에 "?" 아이콘 → 탭하면 한 줄 설명 팝업**

- 예: 베타 — "1보다 크면 시장보다 더 출렁여요. 작으면 덜 출렁여요."
- 예: PER — "주가가 1년 순이익의 몇 배인지. 낮을수록 상대적으로 저평가일 수 있어요."
- 예: 부채비율 — "빚이 자기 자본의 몇 배인지. 낮을수록 재무적으로 안정적이에요."
- 이 설명은 하드코딩. LLM 호출 아님.

**결과 리스트**

- 종목당 한 줄: [Risk Badge] 종목명 / 현재가 / 등락률 / 핵심 지표 2개
- 핵심 지표 2개는 사용자가 적용한 필터 기준으로 자동 선택
- 종목 탭 → Stock Detail로 이동

**정렬 옵션:** 리스크 등급순(기본) / 베타 낮은순·높은순 / 샤프 높은순 / 변동성 낮은순 / PER 낮은순 / ROE 높은순

### 7.4 Stock Detail — 종목 리포트 ✦ UPDATED

**목적:** 하나의 종목에 대해 "지금 어떤 상태이고, 왜 그런지" 이해. 앱의 핵심 화면이자 금융 포용성이 가장 드러나는 곳.

**최상단: 종목 헤더**

- 종목명, 심볼, 시장
- 현재가, 등락률
- Risk Badge (크게)

**섹션 1: 5차원 리스크 성적표**

5개 차원을 카드 형태로 제공한다. "기술적/펀더멘털" 같은 전문 분류는 노출하지 않고, 사용자에게 자연스러운 질문 형태로 전달한다. 각 카드는 [차원 이름 / 등급 배지 / 한 줄 해석 / 펼치면 세부 수치] 구조.

| 차원 카드 | 축약 표시 예시 | 펼침 시 세부 수치 |
|----------|---------------|-----------------|
| 가격 과열도 | 🟡 "RSI가 68로, 과열 구간에 접근 중이에요" | RSI 68, BB %B 0.82 |
| 변동성 | 🟢 "변동성이 안정적이에요" | 베타 0.95, 변동성 z-score 0.4 |
| 추세 강도 | 🟡 "상승 추세가 진행 중이에요" | ADX 31, +DI 28, -DI 16 |
| 회사 체력 | 🟢 "재무 상태가 양호해요" | 부채비율 85% (업종 평균 120%), ROE 14.2%, 영업이익률 18% |
| 밸류에이션 | 🟢 "업종 대비 적정 가격대에 있어요" | PER 12.3 (업종 평균 18), PBR 0.95 |

핵심 원칙:
- 숫자를 보여주되, 바로 옆에 일상어 해석을 붙인다
- 펀더멘털 수치는 항상 업종 평균과 함께 표시하여 맥락을 제공한다
- 카드를 펼치지 않아도 등급 + 한 줄 해석만으로 핵심을 파악할 수 있다

**섹션 2: 가격 차트**

- 기본: 캔들차트 + 20일 이동평균선
- 오버레이 토글 (하단 칩): 볼린저밴드 / MACD / RSI
- 기간 선택: 1개월 / 3개월 / 6개월 / 1년

**섹션 3: AI 해석 (LLM 연동)**

SaramQuant의 가장 큰 차별점.

- "이 종목 분석 요약해줘" 버튼 → LLM이 현재 기술적 지표와 펀더멘털 지표를 종합하여 2~3문단 해석 생성

- 출력 예시:

  > "삼성전자는 현재 RSI 68로 과열 구간에 접근하고 있어요. 다만 베타가 0.95로 시장과 비슷한 수준이고, 샤프 비율이 0.85로 위험 대비 성과는 양호한 편이에요. 볼린저밴드 상단에 가까워지고 있어서, 단기적으로는 조정 가능성을 염두에 두는 게 좋겠어요. 장기 관점에서는 ADX 31로 상승 추세가 아직 유효해요.
  >
  > 재무적으로는 PER 12.3배로 반도체 업종 평균(18배)보다 낮은 편이고, 부채비율 85%로 재무 구조가 안정적이에요. ROE 14.2%는 자기 자본을 효율적으로 쓰고 있다는 의미예요. 가격 흐름에는 과열 주의가 필요하지만, 회사의 체력 자체는 튼튼한 편이에요."

- 프리셋 추가 질문 버튼 (자유 채팅 아님):

  - "초보자한테 이 종목 괜찮아?"
  - "지금 들어가면 위험해?"
  - "비슷한데 더 안정적인 종목 있어?"
  - "이 회사 재무 상태 괜찮아?"

- LLM 응답 하단에 항상 고정: "AI 분석은 투자 조언이 아닌 참고 자료입니다. 투자 판단은 본인의 책임입니다."

**섹션 4: 벤치마크 비교**

- 최근 N일간 해당 종목 vs 벤치마크(코스피 또는 S&P500) 수익률 비교 미니 차트
- "코스피 대비 초과 수익(알파): +3.2% (연환산)"

**하단: 포트폴리오에 추가 버튼**

- 비중 입력 슬라이더 (기본 10%)
- 추가 시 Portfolio Check 화면의 전체 리스크가 즉시 재계산됨

### 7.5 Portfolio Check — 포트폴리오 진단

**목적:** "내가 이 조합으로 들고 있으면 전체적으로 얼마나 위험한가"

**상단: 포트폴리오 Risk Badge (크게)**

- 포트폴리오 전체의 종합 리스크 등급
- 아래에 한 줄 해석: "전체적으로 시장 평균보다 변동성이 낮은 안정적인 구성이에요"

**섹션 1: 핵심 지표 카드 (4개)**

| 지표               | 설명                                                         |
| ------------------ | ------------------------------------------------------------ |
| 포트폴리오 베타    | 가중평균 베타. "시장이 출렁일 때 내 포트폴리오는 얼마나 출렁이는가" |
| 포트폴리오 변동성  | 상관관계 반영한 전체 변동성. 분산 효과 표시                  |
| 가중 샤프 비율     | 전체 위험 대비 성과                                          |
| 재무 건전성 요약 ✦ | 가중평균 부채비율과 ROE. "포트폴리오에 담긴 회사들이 전반적으로 재무가 튼튼한지" |

**섹션 2: 종목 구성 리스트**

- 각 종목: [Risk Badge] 종목명 / 비중(%) / 베타 / 기여 리스크
- 비중 수정: 슬라이더로 조정 → 실시간 재계산
- 종목 추가/삭제 가능

**섹션 3: 분산 효과 시각화**

- "종목별 변동성 합계" vs "상관관계 반영 실제 변동성" 비교 바 차트
- 분산 투자가 리스크를 얼마나 줄였는지 시각적으로 보여줌
- 예: "개별 합산 변동성 18.5% → 분산 효과 적용 후 13.2% (-28.6%)"

**섹션 4: 몬테카를로 시뮬레이션**

- GBM(기하학적 브라운 운동) 기반 1,000개 경로 시뮬레이션
- 부채꼴 형태의 확률 범위 차트 (50%, 75%, 95% 신뢰 구간)
- 사용자에게 보이는 문장: "1년 뒤 이 포트폴리오는 95% 확률로 -12% ~ +28% 범위에 있을 것으로 추정돼요"
- 기간 선택: 3개월 / 6개월 / 1년
- 시뮬레이션 파라미터(μ, σ)는 일봉 데이터에서 자동 추출, 사용자에게 노출하지 않음

**섹션 5: AI 포트폴리오 진단**

- "내 포트폴리오 진단해줘" 버튼

- LLM이 포트폴리오 구성을 보고 종합 의견 생성 (기술적 지표 + 펀더멘털 종합)

- 출력 예시:

  > "현재 포트폴리오는 IT 섹터 비중이 70%로 집중도가 높아요. 삼성전자와 SK하이닉스의 상관관계가 0.72로 높아서 분산 효과가 제한적이에요. 전체 베타가 1.15로 시장보다 약간 더 출렁이는 구성이에요. 리스크를 낮추려면 상관관계가 낮은 업종을 섞어보는 걸 고려해보세요.
  >
  > 재무적으로는 포트폴리오 가중평균 부채비율이 72%로 양호하고, 평균 ROE가 12.8%로 수익성도 괜찮은 편이에요. 다만 SK하이닉스의 영업이익률이 최근 분기 급감했기 때문에, 이 부분이 전체 포트폴리오 수익성에 영향을 줄 수 있어요."

- 무위험금리 활용: "현재 91일 국채 금리가 3.5%인데, 이 포트폴리오의 예상 수익률이 이보다 낮다면 예금이 나을 수 있어요"

- 프리셋 질문:

  - "리스크 줄이려면 어떻게 바꿔야 해?"
  - "이 포트폴리오로 1년 버티면 어떨까?"
  - "더 공격적으로 바꾸고 싶어"
  - "재무가 불안한 종목이 있어?"

**하단: 포트폴리오 저장**

- 여러 개 포트폴리오 저장 가능 (최대 5개)
- 저장된 포트폴리오의 리스크 배지가 매일 업데이트
- Home 화면의 "오늘의 리스크 변화"와 연동

------

## 8. LLM 연동 설계

### 8.1 원칙

- LLM은 "지표를 일상어로 번역하는 도구"이지, 투자 조언자가 아님
- 모든 LLM 응답에 면책 문구 고정
- 매수/매도 추천은 절대 하지 않음. "~를 고려해보세요" 수준까지만

### 8.2 호출 방식

- 프리셋 질문 버튼 방식 (자유 채팅 아님)
- 이유: 자유 채팅은 할루시네이션 리스크가 높고, 프리셋이면 프롬프트를 정밀 제어 가능
- 자유 질문은 v2에서 검토

### 8.3 프롬프트 템플릿 예시

```
시스템: 당신은 투자 초보자를 위한 리스크 해석 도우미입니다.
다음 원칙을 따르세요:
- 매수/매도를 추천하지 않습니다
- 모든 설명은 금융 용어 없이 일상어로 합니다
- 숫자를 언급할 때는 반드시 "이것이 의미하는 바"를 함께 설명합니다
- 기술적 지표(가격 흐름)와 펀더멘털(회사 체력)을 자연스럽게 함께 언급합니다  ✦
- 3문단 이내로 간결하게 답합니다

[종목/포트폴리오 기술적 지표 + 펀더멘털 지표 데이터 주입]  ✦
[사용자 프리셋 질문]
```

### 8.4 비용 관리

- **종목 분석 캐싱**: stock_ai_analyses 테이블에 (stock_id, date, preset, lang) 단위 캐시. 같은 종목+프리셋+언어는 하루 1회만 Claude 호출
- **모델 분리**: 종목 분석은 Sonnet 4.6 (비용 효율), 포트폴리오 진단은 Opus 4.6 (복합 판단)
- **일일 한도**: Standard 등급 20회/일, atomic increment (PostgreSQL upsert)
- **비로그인자 제한**: GET 캐시 조회만 가능, POST 트리거 불가 (익명 식별 불가로 rate limit 우회 방지)
- **프리셋 기반**: 자유 채팅 미허용, 정해진 프리셋만 사용하여 프롬프트 제어
- **Thundering herd 방지**: ConcurrentHashMap 기반 인메모리 락으로 동시 캐시 미스 시 중복 호출 차단
- **캐시 TTL**: 30일 이상된 분석 레코드를 매일 새벽 자동 삭제
- **Fallback**: Claude 2회 실패 시 OpenAI GPT-5.2로 자동 폴백 (지수 백오프)

------

## 9. 디자인 원칙

### 9.1 토스에서 배울 것

- 한 화면에 하나의 메시지
- 숫자는 크게, 설명은 작게
- 스크롤은 깊되 한 뷰포트 안의 정보 밀도는 낮게
- 액션 버튼은 항상 하나만 눈에 띄게

### 9.2 SaramQuant 고유 원칙

- **숫자 옆에 반드시 해석**: 베타 1.32 (X) → 베타 1.32 · 시장보다 좀 더 출렁여요 (O)
- **색상에만 의존하지 않기**: Risk Badge는 항상 색 + 아이콘 + 텍스트 조합
- **공포 조장 금지**: 🔴 배지라고 "위험합니다!!" 같은 강한 표현 사용 안 함. "신중한 판단이 필요한 구간이에요" 정도
- **비교 기준 제공**: 단독 숫자는 의미 없음. 항상 "시장 평균 대비", "최근 20일 대비" 등 기준선 제공
- **무위험금리 기준선 활용**: 샤프비율이나 포트폴리오 기대수익률을 설명할 때 "지금 예금 금리가 X%인데..." 형태로 자연스럽게 기준 제공
- **전문 용어 분류를 노출하지 않기**: "기술적 지표" vs "펀더멘털 지표" 같은 카테고리 구분을 사용자에게 보여주지 않는다. 사용자에게는 그냥 "이 종목을 이해하는 데 필요한 숫자들"일 뿐이다

### 9.3 타이포그래피/컬러

- 주 색상: 짙은 남색 (신뢰감) + 밝은 배경
- Risk 색상: 에메랄드 그린 / 앰버 옐로 / 코랄 레드 (채도 낮게, 편안하게)
- 폰트: 본문 Pretendard, 숫자 강조 시 tabular figures

------

## 10. 아키텍처 요약

```
[Next.js Frontend] ← i18n (한국어/영어) 메시지 렌더링 담당
       ↓
[Spring Boot Gateway (Kotlin)] ← BFF (Backend For Frontend)
  ├── 사용자 인증/관리 (OAuth, JWT)
  ├── REST API 서빙 (모든 GET/POST 요청)
  ├── PostgreSQL 직접 조회 (JPA) — 종목, 가격, 지표, 리스크 뱃지 등 모든 읽기 데이터
  ├── Anthropic API 호출 (LLM 해석)
  └── Calc 서버 호출 — 몬테카를로 시뮬레이션 등 Python 연산이 필요한 경우만
       ↓ (Python 연산만 위임)
[Flask Calc Server]
  ├── 데일리 파이프라인 (데이터 수집 → 지표 계산 → 리스크 뱃지 배치 산출 → DB 저장)
  └── 몬테카를로 시뮬레이션 API (/internal, x-api-key 인증)
```

> Gateway는 Calc 서버의 파이프라인이 매일 DB에 저장해둔 데이터를 JPA로 직접 읽는다. Calc 서버에게 API로 요청하는 것은 numpy 등 Python 런타임이 필요한 연산뿐이다.

**LLM 연동 레이어** (Gateway 내):
- `infra/ai/`: AnthropicClient (Sonnet 4.6 / Opus 4.6), OpenAiClient (GPT-5.2 fallback), LlmRouter (retry + fallback)
- `feature/ai/`: StockAiService (캐싱 + thundering herd 방지), PortfolioAiService, AiUsageService (일일 한도), PromptBuilder (i18n 프롬프트)
- DB: stock_ai_analyses (캐시), ai_usage_logs (사용량 추적)

------

## 11. API 목록 (구현 완료)

### Gateway API (Spring Boot, Kotlin)

**인증 / 사용자**
| Method | Path | Auth | 설명 |
|--------|------|------|------|
| GET | `/login/oauth2/code/{provider}` | - | OAuth 콜백 (Google, Kakao) |
| POST | `/api/auth/refresh` | - | Access Token 재발급 |
| POST | `/api/auth/logout` | - | 로그아웃 (쿠키 제거) |
| GET | `/api/users/me` | ✅ | 내 프로필 |
| PATCH | `/api/users/me` | ✅ | 프로필 수정 (닉네임, 관심시장, 아바타) |

**대시보드 (Screener 통합)**
| Method | Path | Auth | 설명 |
|--------|------|------|------|
| GET | `/api/dashboard/stocks?market=&tier=&sector=&sort=&page=&size=` | - | 종목 카드 목록 (필터/정렬/페이지네이션) |
| GET | `/api/dashboard/sectors?market=` | - | 섹터 필터용 목록 |

**종목 상세 (Stock Detail)**
| Method | Path | Auth | 설명 |
|--------|------|------|------|
| GET | `/api/stocks/{symbol}?market=&lang=` | - | 종목 리포트 (헤더+뱃지+지표+펀더멘털+섹터비교+팩터+AI캐시) |
| GET | `/api/stocks/{symbol}/prices?market=&period=` | - | OHLCV 시계열 (캔들차트용) |
| GET | `/api/stocks/{symbol}/benchmark?market=&period=` | - | 벤치마크 대비 정규화 수익률 |
| GET | `/api/stocks/{symbol}/ai-analysis?market=&preset=&lang=` | - | 캐시된 AI 분석 조회 |

**AI 전략 분석**
| Method | Path | Auth | 설명 |
|--------|------|------|------|
| POST | `/api/ai/stock-analysis` | ✅ + Rate Limit | LLM 종목 분석 트리거 |
| POST | `/api/ai/portfolio-analysis` | ✅ + Rate Limit | LLM 포트폴리오 진단 트리거 |
| GET | `/api/ai/usage` | ✅ | 일일 AI 사용량 조회 |

**포트폴리오**
| Method | Path | Auth | 설명 |
|--------|------|------|------|
| GET | `/api/portfolios` | ✅ | 내 포트폴리오 목록 |
| GET | `/api/portfolios/{id}` | ✅ | 포트폴리오 상세 (보유종목) |
| POST | `/api/portfolios/{id}/buy` | ✅ | 매수 (종목 추가/평균 매입가 산출) |
| POST | `/api/portfolios/{id}/sell/{holdingId}` | ✅ | 매도 (부분/전량) |
| DELETE | `/api/portfolios/{id}/holdings/{holdingId}` | ✅ | 보유종목 삭제 |
| DELETE | `/api/portfolios/{id}/reset` | ✅ | 포트폴리오 초기화 |

**시뮬레이션 (Calc 서버 프록시)**
| Method | Path | Auth | 설명 |
|--------|------|------|------|
| GET | `/api/stocks/{symbol}/simulation?market=&method=&days=&trials=` | - | 몬테카를로 시뮬레이션 |
| POST | `/api/portfolios/{id}/risk-score` | ✅ | 포트폴리오 리스크 점수 |
| POST | `/api/portfolios/{id}/risk` | ✅ | 리스크 분해 (MCAR) |
| POST | `/api/portfolios/{id}/diversification` | ✅ | 분산 효과 분석 (HHI, Effective N) |

### Calc 서버 (Flask, Python) — Internal API

| Method | Path | Auth | 설명 |
|--------|------|------|------|
| POST | `/internal/portfolios/risk-score` | x-api-key | 가중평균 리스크 스코어 |
| POST | `/internal/portfolios/risk` | x-api-key | 공분산 리스크 분해 |
| POST | `/internal/portfolios/diversification` | x-api-key | HHI, Effective N, 분산효과 비율 |
| POST | `/internal/portfolios/price-lookup` | x-api-key | 특정 날짜 종가 + 환율 조회 |
| GET | `/api/stocks/{symbol}/simulation` | x-api-key | 몬테카를로 시뮬레이션 |
| GET | `/health` | - | 헬스 체크 |

------

## 12. MVP 로드맵

### Phase 1 (MVP, 2~3주) (완료)

- Home: 시장 요약 + 리스크 급변 종목
- Stock Detail: 리스크 카드 + 차트 + AI 해석
- Risk Badge 계산 로직 (Flask)
- Spring Gateway 기본 API 구축

### Phase 2 (+1~2주) (완료)

- Screener: 필터 + 결과 리스트
- Portfolio Check: 종목 추가 + 전체 리스크 계산 + 분산 효과

### Phase 3 (+1~2주) (완료)

- 몬테카를로 시뮬레이션 (GBM)
- AI 포트폴리오 진단
- 포트폴리오 저장/불러오기
- Home에 내 포트폴리오 리스크 변화 연동

### Phase 4 (추후)

- ML 예측 모델 연동 (예측 기반 리스크 경고)
- 자유 질문 채팅 (프리셋 → 오픈형)
- 푸시 알림 (배지 변경 시)
- 내재변동성(IV) 고급 지표 추가

------

## 13. 면책 및 규제

- 모든 화면 하단에 고정 면책 문구: "SaramQuant는 투자 자문 서비스가 아닙니다. 제공되는 정보는 참고 자료이며, 투자 판단의 책임은 사용자에게 있습니다."
- LLM 응답에 개별 면책 문구 추가
- "매수", "매도", "추천" 등의 단어는 UI/LLM 어디에서도 사용하지 않음
- Risk Badge는 "투자 등급"이 아닌 "리스크 참고 신호"로 명확히 포지셔닝
- 한국 자본시장법상 투자자문업 등록 여부 검토 필요 (정보 제공과 자문의 경계)

------

수정 이력:

**v1 → v2**: 펀더멘털을 별도 섹션으로 분리하지 않고, Stock Detail의 카드 흐름 안에 자연스럽게 섞어 넣음. Risk Badge에 펀더멘털을 반영하여 "둘 중 더 나쁜 쪽을 따른다"는 원칙 도입.

**v2 → v3 (현재)**: Risk Badge를 단순 3등급에서 **5차원 성적표**(가격 과열도, 변동성, 추세 강도, 회사 체력, 밸류에이션)로 확장. Barra 리스크 모델, MSCI 섹터 상대 비교, Morningstar Uncertainty Rating을 벤치마크로 삼아 설계. "High Risk" 대신 "Warning"이라는 중립적 표현 채택. 펀더멘털은 절대 기준이 아닌 업종 상대 비교로 전환. Stock Detail 카드를 개별 지표 나열에서 5차원 카드로 재구성. 아키텍처를 Gateway DB 직접 조회 + Calc 연산 전용으로 단순화. 한국어/영어 2개 언어 지원(프론트엔드 i18n). 상세 설계는 `saramquant-calc-server/docs/structure/risk_badge_system.md` 참고.